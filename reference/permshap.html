<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Permutation SHAP — permshap • kernelshap</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet"><link href="../dalexverse-2.css" rel="stylesheet"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Permutation SHAP — permshap"><meta property="og:description" content="Permutation SHAP algorithm with respect to a background dataset,
see Strumbelj and Kononenko (2014) for the basic idea.
By default, for up to p=8 features, exact SHAP values are returned
(exact with respect to the selected background data).
Otherwise, the sampling process iterates until the resulting values
are sufficiently precise, and standard errors are provided."><meta property="og:image" content="/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script></head><body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">kernelshap</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.ai/" class="external-link">MI².AI</a> </span>
          <span class="version version-default">0.9.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/kernelshap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Permutation SHAP</h1>
    <small class="dont-index">Source: <a href="https://github.com/ModelOriented/kernelshap/blob/0.9.0/R/permshap.R" class="external-link"><code>R/permshap.R</code></a></small>
    <div class="hidden name"><code>permshap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Permutation SHAP algorithm with respect to a background dataset,
see Strumbelj and Kononenko (2014) for the basic idea.</p>
<p>By default, for up to p=8 features, exact SHAP values are returned
(exact with respect to the selected background data).
Otherwise, the sampling process iterates until the resulting values
are sufficiently precise, and standard errors are provided.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">permshap</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">permshap</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  bg_X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span>,</span>
<span>  feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>  bg_w <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bg_n <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>  exact <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">8L</span>,</span>
<span>  low_memory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">15L</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">10L</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'ranger'</span></span>
<span><span class="fu">permshap</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  bg_X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>  bg_w <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bg_n <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>  exact <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">8L</span>,</span>
<span>  low_memory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">15L</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">10L</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">feature_names</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  survival <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chf"</span>, <span class="st">"prob"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Fitted model object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code>pred_fun(object, X, ...)</code>.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>\((n \times p)\) matrix or <code>data.frame</code> with rows to be explained.
The columns should only represent model features, not the response
(but see <code>feature_names</code> on how to overrule this).</p></dd>


<dt id="arg-bg-x">bg_X<a class="anchor" aria-label="anchor" href="#arg-bg-x"></a></dt>
<dd><p>Background data used to integrate out "switched off" features,
often a subset of the training data (typically 50 to 500 rows).
In cases with a natural "off" value (like MNIST digits),
this can also be a single row with all values set to the off value.
If no <code>bg_X</code> is passed (the default) and if <code>X</code> is sufficiently large,
a random sample of <code>bg_n</code> rows from <code>X</code> serves as background data.</p></dd>


<dt id="arg-pred-fun">pred_fun<a class="anchor" aria-label="anchor" href="#arg-pred-fun"></a></dt>
<dd><p>Prediction function of the form <code>function(object, X, ...)</code>,
providing \(K \ge 1\) predictions per row. Its first argument
represents the model <code>object</code>, its second argument a data structure like <code>X</code>.
Additional (named) arguments are passed via <code>...</code>.
The default, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">stats::predict()</a></code>, will work in most cases.</p></dd>


<dt id="arg-feature-names">feature_names<a class="anchor" aria-label="anchor" href="#arg-feature-names"></a></dt>
<dd><p>Optional vector of column names in <code>X</code> used to calculate
SHAP values. By default, this equals <code>colnames(X)</code>.</p></dd>


<dt id="arg-bg-w">bg_w<a class="anchor" aria-label="anchor" href="#arg-bg-w"></a></dt>
<dd><p>Optional vector of case weights for each row of <code>bg_X</code>.
If <code>bg_X = NULL</code>, must be of same length as <code>X</code>. Set to <code>NULL</code> for no weights.</p></dd>


<dt id="arg-bg-n">bg_n<a class="anchor" aria-label="anchor" href="#arg-bg-n"></a></dt>
<dd><p>If <code>bg_X = NULL</code>: Size of background data to be sampled from <code>X</code>.</p></dd>


<dt id="arg-exact">exact<a class="anchor" aria-label="anchor" href="#arg-exact"></a></dt>
<dd><p>If <code>TRUE</code>, the algorithm will produce exact SHAP values
with respect to the background data.
The default is <code>TRUE</code> for up to eight features, and <code>FALSE</code> otherwise.</p></dd>


<dt id="arg-low-memory">low_memory<a class="anchor" aria-label="anchor" href="#arg-low-memory"></a></dt>
<dd><p>If <code>FALSE</code> (default up to p = 15), the algorithm does p
iterations in one chunk, evaluating Shapley's formula 2p^2 times.
For models with interactions up to order two, you can set this to <code>TRUE</code>
to save time.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>Tolerance determining when to stop. As in CL21, the algorithm keeps
iterating until \(\textrm{max}(\sigma_n)/(\textrm{max}(\beta_n) - \textrm{min}(\beta_n)) &lt; \textrm{tol}\),
where the \(\beta_n\) are the SHAP values of a given observation,
and \(\sigma_n\) their standard errors.
For multidimensional predictions, the criterion must be satisfied for each
dimension separately. The stopping criterion uses the fact that standard errors
and SHAP values are all on the same scale. Ignored if <code>exact = TRUE</code>.
For <code>permshap()</code>, the default is 0.01, while for <code><a href="kernelshap.html">kernelshap()</a></code> it is set to 0.005.</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>If the stopping criterion (see <code>tol</code>) is not reached after
<code>max_iter</code> iterations, the algorithm stops. Ignored if <code>exact = TRUE</code>.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>If <code>TRUE</code>, use <code><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach::foreach()</a></code> and <code>%dofuture%</code> to loop over rows
to be explained. Must register backend beforehand, e.g., <code>plan(multisession)</code>,
see README for an example. Currently disables the progress bar.</p></dd>


<dt id="arg-parallel-args">parallel_args<a class="anchor" aria-label="anchor" href="#arg-parallel-args"></a></dt>
<dd><p>Named list of arguments passed to
<code>foreach::foreach(.options.future = ...)</code>, ideally <code>NULL</code> (default).
Only relevant if <code>parallel = TRUE</code>.
Example on Windows: if <code>object</code> is a GAM fitted with package 'mgcv',
then one might need to set <code>parallel_args = list(packages = "mgcv")</code>.
Similarly, if the model has been fitted with <code>ranger()</code>, then it might be necessary
to pass <code>parallel_args = list(packages = "ranger")</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Set to <code>FALSE</code> to suppress messages and the progress bar.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Optional integer random seed. Note that it changes the global seed.</p></dd>


<dt id="arg-survival">survival<a class="anchor" aria-label="anchor" href="#arg-survival"></a></dt>
<dd><p>Should cumulative hazards ("chf", default) or survival
probabilities ("prob") per time be predicted? Only in <code>ranger()</code> survival models.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class "kernelshap" with the following components:</p><ul><li><p><code>S</code>: \((n \times p)\) matrix with SHAP values or, if the model output has
dimension \(K &gt; 1\), a list of \(K\) such matrices.</p></li>
<li><p><code>X</code>: Same as input argument <code>X</code>.</p></li>
<li><p><code>baseline</code>: Vector of length K representing the average prediction on the
background data.</p></li>
<li><p><code>bg_X</code>: The background data.</p></li>
<li><p><code>bg_w</code>: The background case weights.</p></li>
<li><p><code>m_exact</code>: Number of on-off vectors evaluated once per row of <code>X</code>.</p></li>
<li><p><code>exact</code>: Logical flag indicating whether calculations are exact or not.</p></li>
<li><p><code>txt</code>: Summary text.</p></li>
<li><p><code>predictions</code>: \((n \times K)\) matrix with predictions of <code>X</code>.</p></li>
<li><p><code>algorithm</code>: "permshap".</p></li>
<li><p><code>m</code>: Number of sampled on-off vectors evaluated per iteration (if not exact).</p></li>
<li><p><code>SE</code>: Standard errors corresponding to <code>S</code> (if not exact).</p></li>
<li><p><code>n_iter</code>: Integer vector of length n providing the number of iterations
per row of <code>X</code> (if not exact).</p></li>
<li><p><code>converged</code>: Logical vector of length n indicating convergence per row of <code>X</code>
(if not exact).</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>During each iteration, the algorithm cycles twice through a random permutation:
It starts with all feature components "turned on" (i.e., taking them
from the observation to be explained), then gradually turning off components
according to the permutation.
When all components are turned off, the algorithm - one by one - turns the components
back on, until all components are turned on again. This antithetic scheme allows to
evaluate Shapley's formula twice per feature using a single permutation and a total
of 2p disjoint evaluations of the contribution function.</p>
<p>For models with interactions up to order two, one can show that
even a single iteration provides exact SHAP values for all features
(with respect to the given background dataset).</p>
<p>The Python implementation "shap" uses a similar approach, but without
providing standard errors, and without early stopping.</p>
<p>For faster convergence, we use balanced permutations in the sense that
p subsequent permutations each start with a different feature.
Furthermore, the 2p on-off vectors with sum &lt;=1 or &gt;=p-1 are evaluated only once,
similar to the degree 1 hybrid in <code><a href="kernelshap.html">kernelshap()</a></code>.</p>
    </div>
    <div id="methods-by-class-">
    <h2>Methods (by class)</h2>

<ul><li><p><code>permshap(default)</code>: Default permutation SHAP method.</p></li>
<li><p><code>permshap(ranger)</code>: Permutation SHAP method for "ranger" models, see Readme for an example.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>

<ol><li><p>Erik Strumbelj and Igor Kononenko. Explaining prediction models and individual
predictions with feature contributions. Knowledge and Information Systems 41, 2014.</p></li>
</ol></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># MODEL ONE: Linear regression</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Select rows to explain (only feature columns)</span></span></span>
<span class="r-in"><span><span class="va">X_explain</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate SHAP values</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">permshap</span><span class="op">(</span><span class="va">fit</span>, <span class="va">X_explain</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Exact permutation SHAP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SHAP values of first observations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Sepal.Width Petal.Length Petal.Width   Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.21951350    -1.955357   0.3149451 0.5823533</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.02843097    -1.955357   0.3149451 0.5823533</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MODEL TWO: Multi-response linear regression</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span> <span class="op">+</span> <span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">permshap</span><span class="op">(</span><span class="va">fit</span>, <span class="va">iris</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Exact permutation SHAP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SHAP values of first observations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Sepal.Length</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Petal.Length Petal.Width  Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]     -2.13622 0.005991405 1.237003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]     -2.13622 0.005991405 1.237003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Sepal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Petal.Length Petal.Width  Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]   -0.3647252    -0.62303 1.320153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   -0.3647252    -0.62303 1.320153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note 1: Feature columns can also be selected 'feature_names'</span></span></span>
<span class="r-in"><span><span class="co"># Note 2: Especially when X is small, pass a sufficiently large background data bg_X</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">permshap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span>,</span></span>
<span class="r-in"><span>  <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>  bg_X <span class="op">=</span> <span class="va">iris</span>,</span></span>
<span class="r-in"><span>  feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>, <span class="st">"Species"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Exact permutation SHAP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SHAP values of first observations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Sepal.Length</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Petal.Length Petal.Width  Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]     -2.13622 0.005991405 1.237003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]     -2.13622 0.005991405 1.237003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Sepal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Petal.Length Petal.Width  Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]   -0.3647252    -0.62303 1.320153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   -0.3647252    -0.62303 1.320153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael Mayer, David Watson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>




  </body></html>

